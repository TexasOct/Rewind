# 国际化 (i18n) 指南

本项目使用 `react-i18next` 实现国际化支持。

## 特性

- ✅ 完整的 TypeScript 类型支持
- ✅ 自动验证所有语言文件的 key 一致性
- ✅ 支持嵌套翻译键
- ✅ 语言切换并自动保存到 localStorage
- ✅ 编译时类型检查，防止使用不存在的翻译 key

## 目录结构

```
src/locales/
├── en.ts          # 英文翻译（主翻译文件，作为类型定义来源）
├── zh-CN.ts       # 简体中文翻译
└── index.ts       # 导出所有翻译资源和语言列表
```

## 添加新的翻译

### 1. 在英文翻译文件中添加 key

编辑 `src/locales/en.ts`：

```typescript
export const en = {
  common: {
    save: 'Save',
    cancel: 'Cancel',
    // 添加新的翻译
    submit: 'Submit',
  },
  // 或者添加新的命名空间
  newFeature: {
    title: 'New Feature',
    description: 'Description',
  },
} as const
```

### 2. 在其他语言文件中添加相同的 key

编辑 `src/locales/zh-CN.ts`：

```typescript
export const zhCN: Translation = {
  common: {
    save: '保存',
    cancel: '取消',
    // 添加相同的 key
    submit: '提交',
  },
  newFeature: {
    title: '新功能',
    description: '描述',
  },
}
```

**重要**: `zh-CN.ts` 使用 `Translation` 类型约束，确保所有 key 与 `en.ts` 一致。如果缺少或多出 key，TypeScript 会报错。

### 3. 验证翻译 key 一致性

```bash
pnpm check-i18n
```

这个命令会检查所有语言文件是否包含相同的 key。

## 在组件中使用翻译

### 基本用法

```tsx
import { useTranslation } from 'react-i18next'

function MyComponent() {
  const { t } = useTranslation()

  return (
    <div>
      <h1>{t('common.save')}</h1>
      <p>{t('newFeature.description')}</p>
    </div>
  )
}
```

### 类型安全

由于配置了 TypeScript 类型定义 (`src/types/i18next.d.ts`)，你可以获得完整的自动补全和类型检查：

```tsx
// ✅ 正确：key 存在
t('common.save')

// ❌ 错误：TypeScript 会报错，因为这个 key 不存在
t('common.nonexistent')
```

### 切换语言

```tsx
import { useTranslation } from 'react-i18next'

function LanguageSwitcher() {
  const { i18n } = useTranslation()

  return (
    <select
      value={i18n.language}
      onChange={(e) => i18n.changeLanguage(e.target.value)}
    >
      <option value="en">English</option>
      <option value="zh-CN">简体中文</option>
    </select>
  )
}
```

## 添加新语言

### 1. 创建新的语言文件

创建 `src/locales/ja.ts`（日语示例）：

```typescript
import type { Translation } from './en'

export const ja: Translation = {
  common: {
    save: '保存',
    cancel: 'キャンセル',
    // ... 其他翻译
  },
  // ... 完整的翻译
}
```

### 2. 在 index.ts 中注册

编辑 `src/locales/index.ts`：

```typescript
import { en } from './en'
import { zhCN } from './zh-CN'
import { ja } from './ja' // 添加导入

export const resources = {
  en: { translation: en },
  'zh-CN': { translation: zhCN },
  ja: { translation: ja }, // 添加语言
} as const

export const languages = [
  { code: 'en', name: 'English' },
  { code: 'zh-CN', name: '简体中文' },
  { code: 'ja', name: '日本語' }, // 添加到列表
] as const
```

### 3. 验证

```bash
pnpm check-i18n
```

## 最佳实践

1. **始终以 `en.ts` 为主翻译文件**：所有新的 key 应该先在 `en.ts` 中定义，然后再翻译到其他语言。

2. **使用命名空间组织翻译**：按功能模块划分，如 `common`、`auth`、`dashboard` 等。

3. **使用描述性的 key 名称**：
   ```typescript
   // ✅ 好的命名
   t('auth.loginButton')
   t('dashboard.totalUsers')

   // ❌ 不好的命名
   t('button1')
   t('text2')
   ```

4. **提交前运行验证**：在提交代码前，运行 `pnpm check-i18n` 确保所有语言文件一致。

5. **利用 TypeScript 类型检查**：使用 `Translation` 类型约束所有语言文件，确保编译时就能发现错误。

## 配置

i18n 配置位于 `src/lib/i18n.ts`：

```typescript
i18n
  .use(initReactI18next)
  .init({
    resources,
    lng: getInitialLanguage(), // 从 localStorage 或浏览器语言自动检测
    fallbackLng: 'en',         // 找不到翻译时使用英文
    interpolation: {
      escapeValue: false,      // React 已经处理 XSS
    },
  })
```

## 常见问题

### Q: 如何处理带参数的翻译？

A: 使用插值：

```typescript
// en.ts
{
  welcome: 'Welcome, {{name}}!'
}

// 组件中
t('welcome', { name: 'John' }) // "Welcome, John!"
```

### Q: 如何处理复数形式？

A: 使用 i18next 的复数功能：

```typescript
// en.ts
{
  items: 'item',
  items_other: 'items'
}

// 组件中
t('items', { count: 1 })  // "item"
t('items', { count: 5 })  // "items"
```

### Q: 如何在非组件代码中使用翻译？

A: 直接导入 i18n 实例：

```typescript
import i18n from '@/lib/i18n'

const message = i18n.t('common.error')
```
